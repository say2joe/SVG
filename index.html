<!DOCTYPE html>
<html>
    <head>
        <title>Insight Global - Seating Selection</title>
        <link rel="icon" type="image/png" href="favicon.png">
        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    </head>
    <body>
        <script>
            var $w = $(window), $b = $('body');

            var deckplans = ['deckplan-a','deckplan-b'];

            var Booking = {

                $deckplans: [],

                RoomNumbers: [], Cabins: [],

                reRoomNomenclature: /^\w{1,2}\d{3,4}$/i,

                setCabins: function($deck) {
                    var deck = $deck[0].id;
                    $deck.find('[fill]').each(function(){
                        Booking.Cabins.push(this);
                        this.deck = deck;
                    });
                },

                setRoomNumbers: function($deck) {
                    $deck.find('[font-family]').each(function(){
                        var textNode, $t = $(this), roomNo = $t.text();
                        if (Booking.reRoomNomenclature.test(roomNo)) {
                            if (this.nodeName !== '#text') { // tspan
                                textNode = $t.closest('text')[0];
                            }
                            Booking.RoomNumbers.push(textNode || this);
                        }
                    });
                },

                init: function(svg) {
                    var $deck = $(svg.documentElement).appendTo($b);
                    Booking.$deckplans.push($deck);
                    Booking.setRoomNumbers($deck);
                    Booking.setCabins($deck);
                }

            };

            deckplans.forEach(function(deck) {
                d3.xml('svg/zu-'+ deck +'.svg', 'image/svg+xml', Booking.init);
            });
        </script>
    </body>
</html>
